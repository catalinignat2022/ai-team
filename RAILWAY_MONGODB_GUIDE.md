# Railway MongoDB Deployment Guide - Romanian Dating App

## üöÇ Railway Setup for MongoDB

### Phase 1: Project Setup
1. **Login to Railway**
   ```
   Visit: https://railway.app/
   Login with GitHub account
   ```

2. **Create/Access Project**
   - Find your `romanian-dating-backend-api` project
   - Or create new project from GitHub repo

### Phase 2: Add MongoDB Service
1. **Add Database Service**
   ```
   Dashboard ‚Üí New Service ‚Üí Database ‚Üí MongoDB
   ```

2. **MongoDB Configuration**
   - Version: 7.0 (latest stable)
   - Memory: 512MB
   - Storage: 1GB

3. **Environment Variables (Auto-generated by Railway)**
   ```
   DATABASE_URL=mongodb://username:password@host:port/database
   MONGODB_URI=mongodb://username:password@host:port/database
   ```

### Phase 3: Backend Application Setup
1. **Update Environment Variables**
   ```bash
   # These are automatically set by Railway MongoDB service
   DATABASE_URL=mongodb://...  # Primary connection string
   MONGODB_URI=mongodb://...   # Alternative name
   NODE_ENV=production
   PORT=3000
   ```

2. **Update package.json (if needed)**
   ```json
   {
     "scripts": {
       "start": "node server.js",
       "dev": "nodemon server.js",
       "test": "node test/database-test.js"
     },
     "dependencies": {
       "mongoose": "^7.0.0",
       "express": "^4.18.0",
       "cors": "^2.8.5",
       "helmet": "^6.0.0",
       "dotenv": "^16.0.0"
     }
   }
   ```

### Phase 4: Connection Code (Already Fixed by Database Agent)
The Database Agent has already created optimized connection code in:
- `server.js` - Main server with MongoDB connection
- `database/connection.js` - Dedicated connection module
- `test/database-test.js` - Connection testing

### Phase 5: Deployment Process
1. **Push Code to GitHub**
   ```bash
   git add .
   git commit -m "Add MongoDB connection configuration"
   git push origin main
   ```

2. **Railway Auto-Deploy**
   - Railway automatically deploys from GitHub
   - Monitor deployment in Railway dashboard
   - Check logs for connection status

### Phase 6: Verify Deployment
1. **Check Application Health**
   ```
   GET https://your-app.railway.app/health
   ```

2. **Test Database Connection**
   ```
   GET https://your-app.railway.app/api/users/test
   ```

3. **Monitor Logs**
   - Railway dashboard ‚Üí Deployments ‚Üí Logs
   - Look for "‚úÖ MongoDB connected successfully"

## üîß Troubleshooting Common Issues

### Issue 1: Connection Refused (ECONNREFUSED)
**Symptoms:** `connect ECONNREFUSED ::1:27017`
**Solution:**
1. Verify MongoDB service is running in Railway
2. Check DATABASE_URL environment variable is set
3. Ensure MongoDB service is properly linked to your app

### Issue 2: Authentication Failed
**Symptoms:** `Authentication failed`
**Solution:**
1. Check DATABASE_URL contains correct credentials
2. Verify MongoDB user permissions
3. Ensure database name is correct

### Issue 3: Timeout Errors
**Symptoms:** `Server selection timed out`
**Solution:**
1. Increase serverSelectionTimeoutMS in connection options
2. Check Railway service health
3. Verify network connectivity

## üìä Database Schema - Romanian Dating App

### Collections Structure (Created by Database Agent):
```javascript
// users collection
{
  _id: ObjectId,
  email: String,
  password: String, // hashed
  profile: ObjectId, // reference to profiles
  createdAt: Date,
  lastActive: Date,
  isVerified: Boolean
}

// profiles collection  
{
  _id: ObjectId,
  userId: ObjectId,
  name: String,
  age: Number,
  location: {
    city: String,
    coordinates: [Number, Number] // [longitude, latitude]
  },
  photos: [String], // URLs
  bio: String,
  interests: [String],
  preferences: {
    ageRange: { min: Number, max: Number },
    distance: Number,
    gender: String
  }
}

// matches collection
{
  _id: ObjectId,
  user1: ObjectId,
  user2: ObjectId,
  matchedAt: Date,
  status: String // 'pending', 'matched', 'unmatched'
}

// messages collection
{
  _id: ObjectId,
  matchId: ObjectId,
  sender: ObjectId,
  content: String,
  sentAt: Date,
  readAt: Date
}
```

## üéØ Next Steps After Deployment

1. **Frontend Integration**
   - Frontend Developer Agent will connect to this API
   - Base URL: `https://your-app.railway.app`

2. **API Endpoints** (Will be implemented by Backend Agent)
   - `POST /api/auth/register` - User registration
   - `POST /api/auth/login` - User login
   - `GET /api/profiles/nearby` - Location-based matching
   - `POST /api/matches` - Create match
   - `GET /api/messages/:matchId` - Get messages

3. **Monitoring & Scaling**
   - Monitor Railway metrics
   - Scale MongoDB resources as needed
   - Implement caching for performance

## üîê Security Considerations

1. **Environment Variables**
   - Never commit `.env` files
   - Use Railway's environment variable management
   - Rotate database credentials regularly

2. **Database Security**
   - Enable MongoDB authentication
   - Use strong passwords
   - Implement proper indexing

3. **Application Security**
   - JWT token authentication
   - Password hashing with bcrypt
   - Input validation and sanitization

---

**Generated by Database AI Agent (20+ years experience)**  
**Date:** ${new Date().toISOString()}  
**Project:** Romanian Dating App Backend API
